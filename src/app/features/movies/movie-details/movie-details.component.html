<div class="min-h-screen bg-black text-white">

    <div class="relative w-full bg-zinc-900 shadow-xl">
        <div #videoContainer class="relative w-full aspect-video group">

            <video #videoPlayer
                class="absolute top-0 left-0 w-full h-full object-contain bg-black focus:outline-none"></video>

            <div *ngIf="isLoading()" class="absolute inset-0 flex items-center justify-center bg-black/80 z-10">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"></div>
            </div>

            <!-- Play/Pause Overlay Button -->
            <div class="absolute inset-0 flex items-center justify-center z-20 transition-opacity duration-300"
                [ngClass]="{'opacity-0': isPlaying(), 'opacity-100': !isPlaying() || videoContainerRef?.nativeElement?.matches(':hover')}"
                (click)="togglePlayPause()">
                <button class="text-white text-6xl bg-red-600/50 rounded-full p-4 hover:bg-red-700 focus:outline-none">
                    <svg *ngIf="!isPlaying()" xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <svg *ngIf="isPlaying()" xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9.87V14.13a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>
            </div>

            <!-- Custom Controls Bar -->
            <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/70 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-30">
                <!-- Progress Bar -->
                <div class="flex items-center mb-2">
                    <input #progressBar type="range" value="0" min="0" max="100" step="0.1"
                        class="video-progress-bar w-full h-1 bg-gray-700 appearance-none rounded-lg cursor-pointer">
                </div>

                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <!-- Play/Pause Button -->
                        <button (click)="togglePlayPause()" class="text-white text-2xl mx-2 p-2 rounded-full bg-red-600/50 hover:bg-red-700 focus:outline-none">
                            <svg *ngIf="!isPlaying()" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <svg *ngIf="isPlaying()" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9.87V14.13a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </button>

                        <!-- Current Time / Duration -->
                        <span class="text-sm text-gray-300 mx-2">{{ currentTime() * 1000 | date:'mm:ss' }} / {{ duration() * 1000 | date:'mm:ss' }}</span>

                        <!-- Volume Control -->
                        <div class="flex items-center mx-2">
                            <button (click)="toggleMute()" class="text-white p-2 rounded-full bg-red-600/50 hover:bg-red-700 focus:outline-none">
                                <svg *ngIf="!isMuted()" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                                </svg>
                                <svg *ngIf="isMuted()" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-14 0v-1a1 1 0 011-1h.01M19 11a7 7 0 01-14 0v-1a1 1 0 011-1h.01m0 0v1m0 0h.01M5.01 10.99v1h-.01m0 0v1h-.01m0 0h.01" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.293 17.293A8 8 0 016.707 6.707L16.586 16.586M3 3l3 3m2 2l3 3" />
                                </svg>
                            </button>
                            <input #volumeSlider type="range" min="0" max="1" step="0.01" value="1"
                                class="video-volume-slider w-20 h-1 bg-gray-700 appearance-none rounded-lg cursor-pointer ml-2">
                        </div>
                    </div>

                    <div class="flex items-center">
                        <!-- Speed Control -->
                        <select #speedSelect (change)="setPlaybackSpeed(speedSelect.value)"
                            class="bg-zinc-800 text-white rounded px-2 py-1 text-sm focus:outline-none mx-2">
                            <option value="0.5">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1" selected>Normal</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                        </select>

                        <!-- Fullscreen Button -->
                        <button (click)="toggleFullscreen()" class="text-white p-2 rounded-full bg-red-600/50 hover:bg-red-700 text-2xl mx-2 focus:outline-none">
                            <svg *ngIf="!isFullscreen()" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-5v4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5-5" />
                            </svg>
                            <svg *ngIf="isFullscreen()" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 8h4V4M6 18H4v-4M14 4h4v4M16 18h4v-4" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 lg:px-8 mt-12" *ngIf="movie() as m">

        <div class="flex flex-col md:flex-row md:items-start justify-between gap-8">

            <div class="flex-1">
                <h1 class="text-5xl font-extrabold mb-3 text-white drop-shadow-md">{{ m.name }}</h1>

                <div class="flex flex-wrap items-center gap-4 text-lg font-medium text-gray-300 mb-6">
                    <span class="text-sm font-semibold">{{ m.releaseDate | date:'yyyy' }}</span>
                    <span class="text-sm text-yellow-400">
                        {{ m.views | number }} Visualizações
                    </span>
                    <span
                        class="border border-zinc-700 px-2 py-0.5 rounded text-xs font-bold bg-zinc-800 text-white">HD</span>
                </div>

                <div class="flex gap-4 mb-10">
                    <button (click)="toggleFavorite()" [disabled]="isFavoriteLoading()"
                        class="flex items-center gap-2 bg-zinc-800 text-white px-6 py-3 rounded-lg font-bold text-lg 
                           border border-zinc-700 hover:bg-zinc-700 transition-colors duration-300 disabled:opacity-50">

                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" [class.text-red-600]="isFavorited()"
                            fill="none" viewBox="0 0 24 24" stroke="currentColor"
                            [attr.fill]="isFavorited() ? 'currentColor' : 'none'">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                        {{ isFavorited() ? 'Remover da Lista' : 'Adicionar à Minha Lista' }}
                    </button>
                </div>
            </div>

            <div class="hidden lg:block w-72 shrink-0 self-start">
                <img [src]="m.imageUrl" class="rounded-lg shadow-2xl w-full border border-zinc-800"
                    alt="Poster do filme">
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8 border-t border-zinc-800 pt-8">

            <div class="lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-3">Sinopse</h2>
                <p class="text-gray-400 leading-relaxed text-lg">
                    {{ m.synopsis }}
                </p>
            </div>

            <div>
                <h2 class="text-2xl font-semibold mb-3">Gêneros</h2>
                <div class="flex gap-2 flex-wrap">
                    <span *ngFor="let g of m.genries" class="bg-zinc-800 text-gray-300 text-sm px-3 py-1 rounded-full 
                               hover:bg-red-600 hover:text-white transition-colors duration-200 cursor-pointer">
                        {{ g.name }}
                    </span>
                </div>
            </div>
        </div>

    </div>
</div>
